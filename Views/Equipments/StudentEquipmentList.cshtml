@model GCUSMS.ViewModels.StudentEquipmentAllocationVM

@{ ViewData["Title"] = Model.RequestingStudent.RollNumber + "'s" + " Equipment Allocation List"; }

@{
    Layout = "~/Views/Shared/_Dashboard.cshtml";
}


<div class="m-3">
    @if (Model.RequestingStudent != null)
    {
        <h2 class="alert-heading">
            Equipment Allocation History of <span class="text-primary">@Model.RequestingStudent.FirstName @Model.RequestingStudent.LastName</span>
        </h2>
    }
    <hr />
    <div class="row">
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-blue">
                <span class="info-box-icon"><i class="fa fa-list"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">@Model.TotalEquipmentAllocationss</span>
                    <span class="info-box-number">Total Allocations</span>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-green">
                <span class="info-box-icon"><i class="fa fa-check"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">@Model.ReturnedEquipment</span>
                    <span class="info-box-number text-sm">Returned Equipment</span>
                </div>
            </div>
        </div>

        <div class="clearfix visible-sm-block"></div>

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box bg-red">
                <span class="info-box-icon"><i class="fa fa-times-circle"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">@Model.LostEquipment</span>
                    <span class="info-box-number">Lost Equipment</span>
                </div>
            </div>
        </div>
        @if (@Model.PendingEquipment > 0)
        {
            <div class="col-md-3 col-sm-6 col-xs-12">
                <div class="info-box bg-yellow">
                    <span class="info-box-icon bg-yellow"><i class="fa fa-exclamation"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text animate__animated animate__flash animate__repeat-3 animate__slow">@Model.PendingEquipment <i class="badge badge-danger">NEW</i></span>
                        <span class="info-box-number animate__animated animate__flash animate__repeat-3 animate__slow">Pending Equipment</span>
                    </div>
                </div>
            </div>
        }
        else if (@Model.PendingEquipment == 0)
        {
            <div class="col-md-3 col-sm-6 col-xs-12">
                <div class="info-box bg-yellow">
                    <span class="info-box-icon bg-yellow"><i class="fa fa-exclamation"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">@Model.PendingEquipment</span>
                        <span class="info-box-number">Pending Requests</span>
                    </div>
                </div>
            </div>
        }
    </div>
    <hr />

    <table id="TableData" class="display nowrap table table-striped table-bordered hover">
        <thead>
            <tr>
                <th>
                    Full Name
                </th>
                <th>
                    Roll Number
                </th>
                <th>
                    Equipment Name
                </th>
                <th>
                    Quantity Borrowed
                </th>
                <th>
                    Date Allocated
                </th>
                <th>
                    Return Status
                </th>
                <th>
                    Return Date
                </th>
                <th>
                    Allocated By
                </th>
                <th>
                    Action
                </th>
            </tr>
        </thead>
        <tbody>

            @foreach (var item in Model.EquipmentAllocations)
            {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.RequestingStudent.FirstName)  @Html.DisplayFor(modelItem => item.RequestingStudent.LastName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.RequestingStudent.RollNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.RequestedEquipment.EquipmentName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.QuantityAllocated)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateAllocated)
                </td>
                <td>
                    @if (item.Returned == true)
                    {
                        <span class="badge badge-success">Returned</span>
                    }
                    else if (item.Returned == false)
                    {
                        <span class="badge badge-danger">Lost</span>
                    }
                    else
                    {
                        <span class="badge badge-warning">Pending</span>
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateReturned)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.AllocatedBy)
                </td>
                <td>
                    <a class="btn btn-md btn-outline-primary" asp-action="StudentEquipmentDetails" asp-route-id="@item.Id">
                        <i class="fa fa-file"></i>Details
                    </a>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts
{
    <script>
    $(document).ready(function () {
        $('#TableData').DataTable({

            responsive: {
                details: {
                    display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                            var data = row.data();
                            return data[0]
                        }
                    }),
                    renderer: $.fn.dataTable.Responsive.renderer.tableAll()
                }
            },
        });
    });
    </script>
}